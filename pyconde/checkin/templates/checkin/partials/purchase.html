{% load i18n account_tags %}
<div class="purchase">
    <h2>{% trans "Billing address" %}</h2>
    <p>
        {{ purchase.company_name }}</br>
        {{ purchase.first_name }} {{ purchase.last_name }}</br>
        {{ purchase.street }}</br>
        {{ purchase.zip_code }} {{ purchase.city }}</br>
        {{ purchase.country }}</br>
    </p>
    <div class="state">
    {% if purchase.state == 'payment_received' %}
        <span class="purchase-paid">
            {% trans "Paid!" %}
        </span>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='unpaid' %}" method="POST">{% csrf_token %}<input type="submit" class="btn btn-warning inverted" value="{% trans "Mark as unpaid" %}" /></form>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='cancel' %}" method="POST">{% csrf_token %}<input type="submit" class="btn btn-danger inverted" value="{% trans "Cancel purchase" %}" /></form>
    {% elif purchase.state == 'canceled' %}
        <span class="purchase-canceled">
            {% trans "Canceled!" %}
        </span>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='paid' %}" method="POST">{% csrf_token %}<input type="submit" class="btn btn-success inverted" value="{% trans "Mark as paid" %}" /></form>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='unpaid' %}"  method="POST">{% csrf_token %}<input type="submit" class="btn btn-warning inverted" value="{% trans "Mark as unpaid" %}" /></form>
    {% elif purchase.state == 'invoice_created' %}
        <span class="purchase-unpaid">
            {% trans "Not Paid!" %}
        </span>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='paid' %}" method="POST">{% csrf_token %}<input type="submit" class="btn btn-success inverted" value="{% trans "Mark as paid" %}" /></form>
        <form action="{% url 'checkin_purchase_state' pk=purchase.pk new_state='cancel' %}" method="POST">{% csrf_token %}<input type="submit" class="btn btn-danger inverted" value="{% trans "Cancel purchase" %}" /></form>
    {% elif purchase.state != None %}
        <span class="purchase-unknown">
            {{ purchase.get_state_display|title }}
        </span>
    {% endif %}
    </div>
</div>

<div class="tickets">
    <h2>{% trans "Order overview" %}</h2>
    <table>
        <thead>
            <th>{% trans "Ticket" %}</th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Organization" %}</th>
            <th>{% trans "User" %}</th>
            <th>{% trans "Sponsor" %}</th>
            <th>{% trans "Price" %}</th>
            <th></th>
        </thead>
        {% for ticket in tickets %}
            <tr{% if ticket.canceled %} class="canceled" title="{% trans "This ticket has been canceled and is not valid anymore!" %}"{% endif %}>
                <td>{{ ticket.ticket_type.name }}</td>
                <td>{{ ticket.first_name }} {{ ticket.last_name }}</td>
                <td>{{ ticket.organisation }}</td>
                <td>{{ ticket.user|full_name|default:"" }}</td>
                <td>{{ ticket.sponsor.name }}</td>
                <td>{{ ticket.ticket_type.fee|floatformat:2 }} EUR</td>
                <td>{% if ticket.canceled %}{% trans "Ticket canceled!" %}{% endif %}</td>
            </tr>
        {% endfor %}
        <tr style="font-weight: bold">
            <td colspan="5" style="text-align:right">{% trans "Total:" %}</td>
            <td>{{ purchase.payment_total|floatformat:2 }} EUR</td>
            <td></td>
        </tr>
    </table>

    <p>{% trans "All prices include 19% VAT." %}</p>

    {% if purchase.exported %}
        <a href="{% url 'checkin_purchase_invoice' pk=purchase.pk %}">{% trans "Download the invoice" %}</a>
    {% else %}
        {% trans "Invoice not yet generated. Hang on." %}
    {% endif %}
</div>
