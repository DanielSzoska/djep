{% extends "reviews/proposal_base.html" %}
{% load markup crispy_forms_tags %}
{% block content %}
    <h1>Proposal-Details: {{ proposal.title }}</h1>
    {% if proposal_version %}
        <a href="{{ proposal.get_absolute_url }}">Zum Original</a>
    {% endif %}
    <h2>Aktuelle Version</h2>
    <div class="description">
        {% if proposal_version %}
            {{ proposal_version.description|markdown:"safe" }}
        {% else %}
            {{ proposal.description|markdown:"safe" }}
        {% endif %}
    </div>

    <div class="abstract">
        {% if proposal_version %}
            {{ proposal_version.abstract|markdown:"safe" }}
        {% else %}
            {{ proposal.abstract|markdown:"safe" }}
        {% endif %}
    </div>
    {% if proposal.can_be_updated %}
        <a href="{% url reviews-update-proposal pk=proposal.pk %}">Ändern</a>
    {% else %}
        <a href="#">Vorschläge können nicht mehr editiert werden.</a>
    {% endif %}
    {% if timeline %}
        <ul id="timeline">
        {% for item in timeline %}
            <li class="timeline-item timeline-item-{{ item.type }}">
                <dl>
                {% if item.type == 'comment' %}
                    <dt>{{ item.item.pub_date }}</dt>
                    <dd>{{ item.item.content|markdown:"safe" }}<cite>-- {{ item.item.author }}
                        (basierend auf {% if item.item.proposal_version %} <a href="{% url reviews-version-details proposal_pk=proposal.pk pk=item.item.proposal_version.pk %}">Version vom {{ item.item.proposal_version.pub_date }}</a>{% else %} dem Original-Vorschlag{% endif %})</cite></dd>
                {% else %}
                    <dt>{{ item.item.pub_date }}</dt>
                    <dd>{{ item.item.creator }} hat das Proposal aktualisiert.</dd>
                {% endif %}
                </dl>
            </li>
        {% endfor %}
        </ul>
    {% endif %}
    <h2>Kommentar:</h2>
    {% crispy comment_form %}
{% endblock %}
{% block sidebar %}
    {{ block.super }}
    {% include "reviews/partials/versions_box.html" %}
    {% if can_review %}
    <div class="box" id="review-box">
        {% if not user_review %}
            <h2>Nicht bewertet</h2>
            {% if proposal.can_be_reviewed %}
                <a href="{% url reviews-review-proposal pk=proposal.pk %}">Bewerten</a>
            {% else %}
                <a href="#">Dieser Vorschlag kann nicht mehr bewertet werden.</a>
            {% endif %}
        {% else %}
            <h2>Bewertung: <span class="rating">{{ user_review.rating }}</span></h2>
            <div class="summary">{{ user_review.summary|markdown:"safe" }}</div>
            {% if proposal.can_be_reviewed %}
                <a href="{% url reviews-update-review pk=proposal.pk %}">Bewertung aktualisieren</a>
            {% else %}
                <a href="#">Bewertungen können nicht mehr editiert werden.</a>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}
{% endblock %}
